# Test Design: Story 2.1

Date: 2025-09-26
Designer: Quinn (Test Architect)

## Test Strategy Overview

- Total test scenarios: 10
- Unit tests: 4 (40.0%)
- Integration tests: 5 (50.0%)
- E2E tests: 1 (10.0%)
- Priority distribution: P0: 7, P1: 3, P2: 0

## Test Scenarios by Acceptance Criteria

### AC1: Rule engine cross-checks payslip earnings against statement deposits and proof-of-balance totals, raising blocking errors on mismatches.

#### Scenarios

| ID           | Level       | Priority | Test                                                                                             | Justification                                                                                                 |
| ------------ | ----------- | -------- | ------------------------------------------------------------------------------------------------ | ------------------------------------------------------------------------------------------------------------- |
| 2.1-UNIT-001 | Unit        | P0       | Validate reconciliation algorithm catches mismatched totals within currency tolerances           | Pure calculation logic; critical for data integrity and compliance.                                           |
| 2.1-UNIT-002 | Unit        | P0       | Verify rounding tolerance configuration prevents false positives                                 | Ensures branch conditions around floating-point comparisons behave deterministically.                         |
| 2.1-INT-001  | Integration | P0       | Run rule engine on golden persona with intentional mismatch to confirm blocking error emission    | Confirms integration with schema and manifests; halts bundle generation.                                      |
| 2.1-INT-002  | Integration | P1       | Exercise multi-period reconciliations (weekly vs fortnightly) validating correct matching logic   | Covers edge cadence mapping; slightly lower risk after blocking path validated.                               |

### AC2: Income smoothing, employment tenure, and minimum balance rules map to codified configuration toggles with defaults from the brief.

#### Scenarios

| ID           | Level       | Priority | Test                                                                                           | Justification                                                                                           |
| ------------ | ----------- | -------- | ---------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------- |
| 2.1-UNIT-003 | Unit        | P0       | Ensure default configuration toggles align with brief-specified thresholds                      | Pure config parsing; critical to prevent unsafe defaults.                                              |
| 2.1-INT-003  | Integration | P0       | CLI command reports active configuration vs baseline and highlights overrides                   | Validates governance requirement ensuring operators see drift before runs proceed.                      |
| 2.1-INT-004  | Integration | P1       | Update toggle overrides and confirm rule engine respects changes with audit logging             | Medium risk; ensures overrides flow through configuration pipeline with traceability.                   |

### AC3: Compliance diagnostics attach to manifests with references to violated rule ids for audit traceability.

#### Scenarios

| ID           | Level       | Priority | Test                                                                                            | Justification                                                                                               |
| ------------ | ----------- | -------- | ----------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------- |
| 2.1-UNIT-004 | Unit        | P0       | Diagnostics builder includes rule id, severity, remediation hint, and documentation reference   | Critical manifest contract; keeps audits satisfied and drives remediation.                                 |
| 2.1-INT-005  | Integration | P0       | Execute failing run and validate manifest diagnostics payload plus CLI/UI remediation messaging | Ensures cross-surface consistency and audit traceability.                                                   |

### AC4: Regression suite covers representative edge cases (contractor income, supplemental allowances, irregular deposits).

#### Scenarios

| ID           | Level       | Priority | Test                                                                                      | Justification                                                                                               |
| ------------ | ----------- | -------- | ----------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------- |
| 2.1-INT-006  | Integration | P0       | Regression suite executes personas for contractor, allowance, and irregular deposit cases | Directly mitigates DATA-007 by exercising high-risk scenarios in CI.                                        |
| 2.1-E2E-001  | E2E         | P1       | Full CLI run using edge persona verifies diagnostics, blocking flow, and manifest output   | Confirms end-to-end behaviour for stakeholder demos and audit rehearsals.                                   |

## Risk Coverage

- DATA-007 addressed via deterministic reconciliation unit/integration tests and regression suite.
- TECH-007 covered by configuration diff and override scenarios.
- BUS-003/OPS-006 mitigated by diagnostics contract and remediation verification.

## Recommended Execution Order

1. P0 unit tests (2.1-UNIT-001, 2.1-UNIT-002, 2.1-UNIT-003, 2.1-UNIT-004)
2. P0 integration tests (2.1-INT-001, 2.1-INT-003, 2.1-INT-005, 2.1-INT-006)
3. P1 integration tests (2.1-INT-002, 2.1-INT-004)
4. P1 E2E test (2.1-E2E-001)

## Quality Checklist

- [x] Every AC has test coverage
- [x] Test levels are appropriate (not over-testing)
- [x] No duplicate coverage across levels
- [x] Priorities align with business risk
- [x] Test IDs follow naming convention
- [x] Scenarios are atomic and independent
