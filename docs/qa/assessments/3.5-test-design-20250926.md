# Test Design: Story 3.5

Date: 2025-09-26
Designer: Quinn (Test Architect)

## Test Strategy Overview

- Total test scenarios: 9
- Unit tests: 3 (33.3%)
- Integration tests: 5 (55.6%)
- E2E tests: 1 (11.1%)
- Priority distribution: P0: 7, P1: 2, P2: 0

## Test Scenarios by Acceptance Criteria

### AC1: Secrets for external services reside in managed vault tooling with audit logging.

#### Scenarios

| ID           | Level       | Priority | Test                                                                                         | Justification                                                                                               |
| ------------ | ----------- | -------- | -------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------- |
| 3.5-UNIT-001 | Unit        | P0       | Policy-as-code unit test ensures only vault references allowed in configuration              | Direct mitigation for SEC-011 to prevent non-vault usage.                                                   |
| 3.5-INT-001  | Integration | P0       | Pipeline scan verifies repos/CI artifacts contain no plaintext secrets before deploy         | Critical to ensure governance across workflows.                                                             |
| 3.5-INT-002  | Integration | P0       | Service startup fetches credentials exclusively via vault SDK with audit log verification    | Confirms runtime integration and logging for audit trails.                                                  |

### AC2: Rotation workflows automate key refresh and propagate updates without redeploying core services.

#### Scenarios

| ID           | Level       | Priority | Test                                                                                           | Justification                                                                                         |
| ------------ | ----------- | -------- | ---------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------- |
| 3.5-INT-003  | Integration | P0       | Rotation pipeline run in staging rotates secrets, triggers hot-reload, and records success     | Mitigates OPS-015 and PERF-011 by validating automation.                                              |
| 3.5-INT-004  | Integration | P1       | Chaos test forces rotation failure and verifies alerting plus rollback behaviour               | Medium risk to ensure resilience in failure scenarios.                                                |

### AC3: Alerting warns operators before secret expiry and when rotation attempts fail.

#### Scenarios

| ID           | Level       | Priority | Test                                                                                       | Justification                                                                                             |
| ------------ | ----------- | -------- | ------------------------------------------------------------------------------------------ | --------------------------------------------------------------------------------------------------------- |
| 3.5-UNIT-002 | Unit        | P0       | Alert configuration unit test validates thresholds and notification targets                | Keeps monitoring aligned with governance.                                                                |
| 3.5-INT-005  | Integration | P0       | Synthetic expiry scenario triggers alert routed to on-call with correlation ID             | Ensures detection mechanisms work before actual expiry.                                                 |

### AC4: Documentation details rotation cadence, emergency procedures, and responsible owners.

#### Scenarios

| ID           | Level       | Priority | Test                                                                                          | Justification                                                                                             |
| ------------ | ----------- | -------- | --------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------- |
| 3.5-UNIT-003 | Unit        | P1       | Documentation lint ensures rotation playbooks list cadence, owners, and escalation contacts   | Medium risk but required for BUS-010 compliance.                                                           |
| 3.5-E2E-001  | E2E         | P0       | Tabletop exercise (simulated via automation) executes emergency rotation using documentation | Validates readiness and mitigates OPS-015/SEC-011 residual risk.                                          |

## Risk Coverage

- SEC-011 addressed via policy unit test, pipeline scan, and runtime vault verification.
- OPS-015/PERF-011 mitigated by rotation automation, chaos test, and tabletop exercise.
- DATA-014 handled by audit logging verification and rotation failure tests (ensuring logs scrubbed).
- BUS-010 covered by documentation lint scenario.

## Recommended Execution Order

1. P0 unit tests (3.5-UNIT-001, 3.5-UNIT-002)
2. P0 integration tests (3.5-INT-001, 3.5-INT-002, 3.5-INT-003, 3.5-INT-005)
3. P0 E2E test (3.5-E2E-001)
4. P1 tests (3.5-INT-004, 3.5-UNIT-003)

## Quality Checklist

- [x] Every AC has test coverage
- [x] Test levels are appropriate (not over-testing)
- [x] No duplicate coverage across levels
- [x] Priorities align with business risk
- [x] Test IDs follow naming convention
- [x] Scenarios are atomic and independent
