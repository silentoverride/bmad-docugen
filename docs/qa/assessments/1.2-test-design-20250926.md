# Test Design: Story 1.2

Date: 2025-09-26
Designer: Quinn (Test Architect)

## Test Strategy Overview

- Total test scenarios: 9
- Unit tests: 3 (33.3%)
- Integration tests: 5 (55.6%)
- E2E tests: 1 (11.1%)
- Priority distribution: P0: 7, P1: 2, P2: 0

## Test Scenarios by Acceptance Criteria

### AC1: CLI supports dry-run validation and generation modes with consistent exit codes.

#### Scenarios

| ID           | Level       | Priority | Test                                                                                          | Justification                                                                                                   |
| ------------ | ----------- | -------- | --------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------- |
| 1.2-UNIT-001 | Unit        | P0       | Validate CLI mode parser and exit code mapper return deterministic results for success/failure | Critical control logic is pure function; fast feedback prevents regressions in user-visible behaviour.          |
| 1.2-INT-001  | Integration | P0       | Execute dry-run command with invalid config to confirm validation errors and exit code 2       | Exercises CLI boundary plus schema validator wiring to guarantee dry-run semantics match spec.                   |
| 1.2-INT-002  | Integration | P0       | Execute generation command on golden config to confirm manifest emission and exit code 0       | Validates generation pipeline and ensures downstream tasks receive artefacts only when success criteria are met. |

### AC2: Manifest records hash of inputs, timestamp, operator id, and selected artefacts with SHA-256 signatures.

#### Scenarios

| ID           | Level       | Priority | Test                                                                                 | Justification                                                                                         |
| ------------ | ----------- | -------- | ------------------------------------------------------------------------------------ | ----------------------------------------------------------------------------------------------------- |
| 1.2-UNIT-002 | Unit        | P0       | Manifest builder includes required metadata fields and canonical SHA-256 hash logic | Pure transformation; isolates hash/signature construction for exhaustive branch coverage.             |
| 1.2-INT-003  | Integration | P0       | CLI integrates with signing service/KMS to append verifiable signatures              | Verifies boundary with external signing stack; critical for audit readiness.                          |
| 1.2-E2E-001  | E2E         | P0       | Golden CLI run produces signed manifest matching expected metadata snapshot         | Confirms full user journey, ensuring metadata passes through CLI, signing, and output packaging layers. |

### AC3: Deterministic seeding ensures repeated runs with identical inputs produce identical manifests and intermediate datasets.

#### Scenarios

| ID           | Level       | Priority | Test                                                                                       | Justification                                                                                                            |
| ------------ | ----------- | -------- | ------------------------------------------------------------------------------------------ | ------------------------------------------------------------------------------------------------------------------------ |
| 1.2-UNIT-003 | Unit        | P1       | Seed normaliser orders inputs and strips volatile fields before orchestration              | Keeps determinism guarantees isolated to pure functions; slightly lower risk but essential for stability.                |
| 1.2-INT-004  | Integration | P0       | Run CLI twice with identical inputs and diff manifests plus intermediate artefacts         | High-risk regression coverage ensuring determinism claims hold across real execution, not just unit-level normalisation. |

### AC4: CI job executes CLI against seed data on every merge, storing manifest artefacts as build outputs.

#### Scenarios

| ID           | Level       | Priority | Test                                                                                       | Justification                                                                                           |
| ------------ | ----------- | -------- | ------------------------------------------------------------------------------------------ | ------------------------------------------------------------------------------------------------------- |
| 1.2-INT-005  | Integration | P1       | Simulated CI workflow runs CLI, publishes manifests as artefacts, and verifies retention   | Ensures pipeline wiring, storage paths, and retention policies behave as documented for compliance traceability. |

## Risk Coverage

Matches risk profile focus on deterministic manifests and signing integrity. P0 coverage concentrates on hash/signature fidelity and deterministic execution, directly mitigating DATA-002 and SEC-001 risks.

## Recommended Execution Order

1. P0 unit tests (1.2-UNIT-001, 1.2-UNIT-002)
2. P0 integration tests (1.2-INT-001, 1.2-INT-002, 1.2-INT-003, 1.2-INT-004)
3. P0 E2E test (1.2-E2E-001)
4. P1 tests (1.2-UNIT-003, 1.2-INT-005)

## Quality Checklist

- [x] Every AC has test coverage
- [x] Test levels are appropriate (not over-testing)
- [x] No duplicate coverage across levels
- [x] Priorities align with business risk
- [x] Test IDs follow naming convention
- [x] Scenarios are atomic and independent
