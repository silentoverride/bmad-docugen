# Risk Profile: Story 1.2

Date: 2025-09-26
Reviewer: Quinn (Test Architect)

## Executive Summary

- Total Risks Identified: 5
- Critical Risks: 1
- High Risks: 2
- Risk Score: 50/100

Story 1.2 owns the deterministic CLI orchestrator that every DocuGen execution path depends on. The dominant exposure centres on preserving determinism and audit fidelity under both dry-run and full generation modes. Any divergence between manifest hashing, signing, and CI capture will cascade into downstream compliance evidence gaps.

## Critical Risks Requiring Immediate Attention

### 1. DATA-002: Non-Deterministic Manifest Hashes
**Score:** 9 (Critical)

- **Probability:** High (3) – Timestamp precision, unordered JSON serialisation, or hidden environment variables frequently leak into manifests when orchestration logic evolves quickly.
- **Impact:** High (3) – Breaks reproducibility guarantees, invalidates compliance attestations, and erodes trust in DocuGen outputs across CLI, API, and queue consumers.
- **Mitigation:**
  - Normalise manifest construction (field ordering, canonical timestamps) before hashing/signing.
  - Add golden-manifest snapshot tests that diff outputs across repeated runs and OS environments.
  - Enforce deterministic random seeds and configuration whitelists at orchestrator entry.
- **Testing Focus:** Determinism regression suite comparing multiple executions; contract tests verifying manifest hash stability.

## High-Risk Items

### 2. TECH-003: Divergent Dry-Run vs Generation Logic
**Score:** 6 (High)

- **Probability:** Medium (2) – Mode branching often introduces unique validation or execution code paths that fall out of sync.
- **Impact:** High (3) – Operators may see false positives in dry-run that mask production failures or vice versa, undermining confidence in the CLI.
- **Mitigation:**
  - Consolidate shared validation pipeline and reuse identical code paths with flags controlling side effects only.
  - Add contract tests ensuring dry-run and generation mode outputs align for identical inputs.
  - Gate mode-specific changes behind pair reviews involving validation owners.
- **Testing Focus:** Integration tests executing both modes and comparing run metadata.

### 3. SEC-001: Manifest Signing Key Governance Gaps
**Score:** 6 (High)

- **Probability:** Medium (2) – Early implementations may embed signing keys in CI secrets without rotation or audit trails.
- **Impact:** High (3) – Compromised keys allow manifest forgery, invalidating audit evidence and violating security policies.
- **Mitigation:**
  - Store signing keys in managed KMS with rotation schedule and access policies tied to service roles.
  - Log signing operations with trace IDs for audit review; alert on unexpected key usage.
  - Include security review before rolling out CLI signing changes.
- **Testing Focus:** Security-focused integration tests validating signature verification and failure handling when keys rotate.

## Medium-Risk Items

### 4. OPS-002: CI Pipeline Drops Manifest Artefacts
**Score:** 4 (Medium)

- **Probability:** Medium (2) – CI storage steps and build caches regularly misconfigure paths or retention policies.
- **Impact:** Medium (2) – Missing artefacts break traceability for compliance and slow down regression analysis.
- **Mitigation:**
  - Codify CI workflow with explicit artefact retention and checksum verification.
  - Add pipeline smoke tests that fail builds when manifests are absent or corrupt.
  - Monitor CI storage metrics and alert on artefact upload failures.
- **Testing Focus:** CI integration tests and canary jobs confirming artefact availability post-build.

### 5. BUS-002: Manifest Metadata Omits Required Audit Fields
**Score:** 4 (Medium)

- **Probability:** Medium (2) – Business stakeholders may introduce new auditing needs (e.g., consent references) after initial implementation.
- **Impact:** Medium (2) – Incomplete metadata forces manual reconciliation and undermines regulator-facing evidence bundles.
- **Mitigation:**
  - Tie manifest schema to compliance matrix with explicit acceptance checks in PR reviews.
  - Add automated validation ensuring required business fields are present before signing.
  - Document manifest field lifecycle and ownership for future enhancements.
- **Testing Focus:** Schema validation tests asserting presence of mandatory audit attributes.

## Risk Distribution

### By Category
- Technical: 1 risk (0 critical, 1 high, 0 medium)
- Data: 1 risk (1 critical, 0 high, 0 medium)
- Security: 1 risk (0 critical, 1 high, 0 medium)
- Operational: 1 risk (0 critical, 0 high, 1 medium)
- Business: 1 risk (0 critical, 0 high, 1 medium)
- Performance: 0 risks (0 critical)

### By Component
- CLI orchestrator core: 2 risks
- Manifest signing pipeline: 2 risks
- CI workflow: 1 risk

## Risk Matrix

| Risk ID  | Description                                  | Probability | Impact | Score | Priority |
|----------|----------------------------------------------|-------------|--------|-------|----------|
| DATA-002 | Non-deterministic manifest hashes             | High (3)    | High (3) | 9   | Critical |
| TECH-003 | Divergent dry-run vs generation logic         | Medium (2)  | High (3) | 6   | High     |
| SEC-001  | Manifest signing key governance gaps          | Medium (2)  | High (3) | 6   | High     |
| OPS-002  | CI pipeline drops manifest artefacts          | Medium (2)  | Medium (2) | 4 | Medium   |
| BUS-002  | Manifest metadata omits audit-required fields | Medium (2)  | Medium (2) | 4 | Medium   |

## Detailed Risk Register

| Risk ID  | Category | Components Affected                       | Detection Method                          | Mitigation Owner      | Residual Risk |
|----------|----------|-------------------------------------------|-------------------------------------------|-----------------------|----------------|
| DATA-002 | Data     | Manifest builder, hashing module          | Determinism regression testing            | Platform Engineering  | Low once canonicalisation enforced |
| TECH-003 | Technical | CLI validation and execution modes       | Mode parity integration tests             | CLI Lead              | Medium – requires continuous parity checks |
| SEC-001  | Security | Signing service, key management workflow | Security architecture review, penetration | Security Engineering  | Medium – depends on rotation discipline |
| OPS-002  | Operational | CI pipeline, artefact storage         | CI audit logs, canary builds              | DevOps                | Low – with monitoring alerts |
| BUS-002  | Business | Manifest schema, compliance documentation | Compliance sign-off checklist             | Product & Compliance  | Medium – ongoing governance required |

## Risk-Based Testing Strategy

### Priority 1: Critical & High Risks
- Determinism regression suite comparing manifests across repeated CLI runs (DATA-002).
- Dual-mode integration tests ensuring dry-run/generation parity (TECH-003).
- Security tests verifying signature validation, key rotation behaviour, and failure handling (SEC-001).

### Priority 2: Medium Risks
- CI pipeline validation scripts asserting manifest artefact availability (OPS-002).
- Schema validation tests ensuring audit metadata completeness (BUS-002).

### Priority 3: Baseline Regression
- Unit tests for manifest builders and hashing helpers.
- CLI smoke tests covering exit code semantics and error payload structure.

## Risk Acceptance Criteria

### Must Fix Before Production
- DATA-002 must be resolved to guarantee deterministic manifests.
- SEC-001 mitigations must be in place before distributing signed artefacts externally.

### Can Deploy with Mitigation
- TECH-003 acceptable if parity tests run per commit and divergences trigger production alerts.
- OPS-002 and BUS-002 acceptable with monitoring, documentation, and backlog for follow-up enhancements.

### Accepted Risks
- None currently accepted; revisit after initial orchestrator rollout.

## Monitoring Requirements
- Add manifest hash comparison metrics to CI dashboards with failure alerts.
- Track signing key usage and rotation events with audit logging.
- Instrument CLI runs to publish mode usage statistics and error codes.

## Risk Review Triggers
- Changes to manifest schema or signing pipeline.
- Introduction of new execution modes or environment-specific overrides.
- CI/CD pipeline refactors affecting artefact retention.

## Recommendations Summary
- Invest in deterministic manifest guardrails early to safeguard downstream compliance stories.
- Harden signing key management with KMS integration and security monitoring.
- Keep dry-run and generation paths unified, with automation to detect drift immediately.

Risk profile: docs/qa/assessments/1.2-risk-20250926.md
