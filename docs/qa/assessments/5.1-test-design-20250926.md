# Test Design: Story 5.1

Date: 2025-09-26
Designer: Quinn (Test Architect)

## Test Strategy Overview

- Total test scenarios: 9
- Unit tests: 3 (33.3%)
- Integration tests: 5 (55.6%)
- E2E tests: 1 (11.1%)
- Priority distribution: P0: 7, P1: 2, P2: 0

## Test Scenarios by Acceptance Criteria

### AC1: Compliance rules live in dedicated package with semantic versioning, changelog, and dependency graph annotations.

#### Scenarios

| ID           | Level       | Priority | Test                                                                                          | Justification                                                                                               |
| ------------ | ----------- | -------- | --------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------- |
| 5.1-UNIT-001 | Unit        | P0       | Version policy validator ensures SemVer increments align with commit types                    | Direct mitigation for DATA-020 to prevent incorrect releases.                                              |
| 5.1-INT-001  | Integration | P0       | Automated release pipeline generates changelog and dependency graph, blocking on missing data | Ensures release process enforces metadata completeness.                                                    |
| 5.1-INT-002  | Integration | P0       | Negative test attempts publish with missing changelog entry and expects pipeline failure      | Confirms governance guardrails.                                                                            |

### AC2: `docugen compliance diff` compares rule versions highlighting breaking and additive changes with linked documentation.

#### Scenarios

| ID           | Level       | Priority | Test                                                                                           | Justification                                                                                               |
| ------------ | ----------- | -------- | ---------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------- |
| 5.1-UNIT-002 | Unit        | P0       | Diff engine unit test covers additive/breaking/metadata changes using fixtures                 | Ensures new rule attributes produce correct diff output (TECH-015).                                        |
| 5.1-INT-003  | Integration | P0       | CLI integration test runs diff between consecutive versions and validates doc links            | Provides end-to-end verification of user-facing output.                                                    |

### AC3: Regression suite covers baseline scenarios and runs in CI on rule updates.

#### Scenarios

| ID           | Level       | Priority | Test                                                                                              | Justification                                                                                          |
| ------------ | ----------- | -------- | ------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------ |
| 5.1-INT-004  | Integration | P0       | Regression suite executes baseline scenarios automatically when rule package changes            | Keeps OPS-021 under control by enforcing coverage gating.                                              |
| 5.1-E2E-001  | E2E         | P1       | Full CLI pipeline using latest rule package ensures regression suite and diff outputs recorded | Provides holistic confidence for major version releases; medium risk after integration coverage.      |

### AC4: Rule metadata records effective dates and approval signatures for audit review.

#### Scenarios

| ID           | Level       | Priority | Test                                                                                         | Justification                                                                                           |
| ------------ | ----------- | -------- | -------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------- |
| 5.1-UNIT-003 | Unit        | P1       | Metadata schema lint ensures effective date, approver, and sign-off references present       | Medium risk ensures completeness.                                                                       |
| 5.1-INT-005  | Integration | P0       | Manifest ingestion test verifies rule metadata stored alongside compliance evidence           | Links metadata to manifests for audit traceability (BUS-016 mitigation).                                |

## Risk Coverage

- DATA-020 controlled by version policy test and release pipeline validation.
- TECH-015 mitigated via diff engine unit/integration scenarios.
- SEC-016 addressed by publish guard tests and release pipeline gating.
- OPS-021 covered by regression suite enforcement.
- BUS-016 handled through metadata schema lint and evidence linkage test.

## Recommended Execution Order

1. P0 unit tests (5.1-UNIT-001, 5.1-UNIT-002)
2. P0 integration tests (5.1-INT-001, 5.1-INT-002, 5.1-INT-003, 5.1-INT-004, 5.1-INT-005)
3. P1 tests (5.1-E2E-001, 5.1-UNIT-003)

## Quality Checklist

- [x] Every AC has test coverage
- [x] Test levels are appropriate (not over-testing)
- [x] No duplicate coverage across levels
- [x] Priorities align with business risk
- [x] Test IDs follow naming convention
- [x] Scenarios are atomic and independent
