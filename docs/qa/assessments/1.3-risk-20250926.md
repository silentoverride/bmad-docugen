# Risk Profile: Story 1.3

Date: 2025-09-26
Reviewer: Quinn (Test Architect)

## Executive Summary

- Total Risks Identified: 5
- Critical Risks: 1
- High Risks: 3
- Risk Score: 45/100

Story 1.3 delivers the initial NAB artefact rendering flow. The largest risks stem from maintaining visual fidelity while keeping output binaries deterministic across environments and storage surfaces. Rendering inconsistencies or insecure staging storage would erode trust in preview bundles and compromise downstream compliance evidence.

## Critical Risks Requiring Immediate Attention

### 1. DATA-004: Rendering Non-Determinism Across Environments
**Score:** 9 (Critical)

- **Probability:** High (3) – Headless Chromium runs often pick up host-specific fonts, locale defaults, or timing artefacts without strict sandboxing.
- **Impact:** High (3) – Undermines checksum guarantees, makes regression diffs noisy, and jeopardises auditing that expects byte-identical PDFs.
- **Mitigation:**
  - Containerise Puppeteer with pinned Chromium build, fonts, and timezone.
  - Strip volatile data (timestamps, random IDs) before PDF generation; inject deterministic metadata instead.
  - Add binary diff regression tests comparing repeat runs in CI and local environments.
- **Testing Focus:** Cross-platform determinism tests with checksum assertions after multiple renders.

## High-Risk Items

### 2. TECH-004: Headless Rendering Pipeline Flakiness
**Score:** 6 (High)

- **Probability:** Medium (2) – Puppeteer scripts frequently suffer from race conditions and resource limitations in CI.
- **Impact:** High (3) – Render failures block bundle generation, delaying UX validation and compliance sign-offs.
- **Mitigation:**
  - Implement retry-able render orchestration with health checks and graceful degradation.
  - Monitor Chromium launch metrics; pre-warm browsers to reduce startup variance.
  - Include detailed logging and screenshots on failure for rapid diagnosis.
- **Testing Focus:** Stress tests rendering multiple artefacts concurrently in CI and staging.

### 3. DATA-003: Placeholder Mismatch with Shared Schema
**Score:** 6 (High)

- **Probability:** High (3) – Template authors may introduce ad-hoc placeholders that fall out of sync with Story 1.1 schema evolution.
- **Impact:** Medium (2) – Missing data fields render blank sections, eroding reviewer confidence and requiring manual template fixes.
- **Mitigation:**
  - Generate templates with typed bindings driven from schema definitions.
  - Add linting that fails builds if placeholders lack mapped schema fields.
  - Keep shared template metadata documenting field usage and evolution history.
- **Testing Focus:** Contract tests verifying template bindings exist for every schema-required field.

### 4. SEC-002: Staging Bucket Exposure of PII-like Artefacts
**Score:** 6 (High)

- **Probability:** Medium (2) – Early staging buckets often default to broad IAM permissions or lack encryption enforcement.
- **Impact:** High (3) – Sample data may still contain sensitive constructs; exposure harms trust and violates security policies.
- **Mitigation:**
  - Apply least-privilege IAM roles, encryption-at-rest, and access logging for the staging bucket.
  - Automate bucket policy validation in CI with guardrail scripts.
  - Mask or redact any quasi-PII fields within sample data before upload.
- **Testing Focus:** Security posture tests verifying bucket ACLs, encryption flags, and access audit coverage.

## Medium-Risk Items

### 5. OPS-003: Artefact Retention and Lifecycle Drift
**Score:** 4 (Medium)

- **Probability:** Medium (2) – Storage lifecycle rules or manual clean-up may delete artefacts before QA review.
- **Impact:** Medium (2) – Lost PDFs hinder visual regression analysis and break manifest-link references set by Story 1.2.
- **Mitigation:**
  - Define retention policies aligned with QA review windows and compliance retention needs.
  - Implement automated jobs verifying expected artefact counts per manifest.
  - Track storage health metrics and alert on unexpected deletions.
- **Testing Focus:** Operational tests confirming lifecycle policies and recoverability via backups.

## Risk Distribution

### By Category
- Data: 2 risks (1 critical, 1 high)
- Technical: 1 risk (0 critical, 1 high)
- Security: 1 risk (0 critical, 1 high)
- Operational: 1 risk (0 critical, 0 high, 1 medium)
- Performance: 0 risks (0 critical)
- Business: 0 risks (0 critical)

### By Component
- Rendering pipeline: 2 risks
- Template assets: 1 risk
- Storage bucket: 2 risks

## Risk Matrix

| Risk ID  | Description                                   | Probability | Impact | Score | Priority |
|----------|-----------------------------------------------|-------------|--------|-------|----------|
| DATA-004 | Rendering non-determinism across environments  | High (3)    | High (3) | 9   | Critical |
| TECH-004 | Headless rendering pipeline flakiness          | Medium (2)  | High (3) | 6   | High     |
| DATA-003 | Placeholder mismatch with shared schema        | High (3)    | Medium (2) | 6 | High     |
| SEC-002  | Staging bucket exposure of PII-like artefacts  | Medium (2)  | High (3) | 6   | High     |
| OPS-003  | Artefact retention and lifecycle drift         | Medium (2)  | Medium (2) | 4 | Medium   |

## Detailed Risk Register

| Risk ID  | Category | Components Affected                 | Detection Method                              | Mitigation Owner      | Residual Risk |
|----------|----------|-------------------------------------|-----------------------------------------------|-----------------------|----------------|
| DATA-004 | Data     | Puppeteer renderers, manifest bundler | Binary diff regression, checksum monitors     | Platform Engineering  | Low once containerisation enforced |
| TECH-004 | Technical | Rendering pipeline infrastructure  | CI flake analysis, stress testing             | Rendering Lead        | Medium – headless instability persists |
| DATA-003 | Data     | Template files, schema bindings     | Template linting, integration tests           | Template SME          | Medium – schema evolution ongoing |
| SEC-002  | Security | Staging S3 bucket, IAM policies     | Security scans, bucket policy audits          | Security Engineering  | Low with automated guardrails |
| OPS-003  | Operational | Storage lifecycle management     | Storage metrics dashboards, manifest audits   | Platform Ops          | Medium – reliant on continual monitoring |

## Risk-Based Testing Strategy

### Priority 1: Critical & High Risks
- Deterministic rendering regression tests across multiple environments (DATA-004).
- CI stress suite for Puppeteer with retries and diagnostics enabled (TECH-004).
- Template-schema binding contract tests plus security checks on staging storage (DATA-003, SEC-002).

### Priority 2: Medium Risks
- Operational checks verifying artefact retention policies and recovery paths (OPS-003).

### Priority 3: Baseline Regression
- Visual regression snapshots for key templates.
- Smoke tests validating storage uploads and manifest link integrity.

## Risk Acceptance Criteria

### Must Fix Before Production
- DATA-004 mitigations required to uphold checksum-based QA.
- SEC-002 requires staging hardening prior to sharing artefacts outside engineering.

### Can Deploy with Mitigation
- TECH-004 acceptable with robust retry plus diagnostics and monitoring.
- DATA-003 acceptable if template linting blocks mismatched placeholders.
- OPS-003 acceptable when retention monitoring and documented recovery procedures exist.

### Accepted Risks
- None accepted currently.

## Monitoring Requirements
- Track render success rates, retry counts, and render duration metrics.
- Monitor S3 bucket access logs, encryption status, and lifecycle actions.
- Alert on checksum mismatches or missing artefacts per manifest in staging.

## Risk Review Triggers
- Template updates or new institution variants.
- Rendering infrastructure upgrades (Chromium version, container base image).
- Storage policy changes or new compliance requirements.

## Recommendations Summary
- Lock down rendering environments for deterministic output.
- Integrate schema-driven template validation to prevent placeholder drift.
- Harden staging storage controls before engaging external reviewers.

Risk profile: docs/qa/assessments/1.3-risk-20250926.md
