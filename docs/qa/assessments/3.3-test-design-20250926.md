# Test Design: Story 3.3

Date: 2025-09-26
Designer: Quinn (Test Architect)

## Test Strategy Overview

- Total test scenarios: 9
- Unit tests: 2 (22.2%)
- Integration tests: 6 (66.7%)
- E2E tests: 1 (11.1%)
- Priority distribution: P0: 7, P1: 2, P2: 0

## Test Scenarios by Acceptance Criteria

### AC1: Bundles compress into signed archives containing PDFs, manifest, reconciliation report, and checksums.

#### Scenarios

| ID           | Level       | Priority | Test                                                                                               | Justification                                                                                               |
| ------------ | ----------- | -------- | -------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------- |
| 3.3-UNIT-001 | Unit        | P0       | Packaging manifest enumerates required artefacts and validates presence before archive generation | Prevents missing components (DATA-012 mitigation).                                                          |
| 3.3-INT-001  | Integration | P0       | Run packaging pipeline on golden run verifying archive contents and structure                      | Ensures end-to-end coverage of mandatory artefacts.                                                         |
| 3.3-INT-002  | Integration | P0       | Negative test removing required file ensures pipeline fails with actionable error                  | Guarantees packaging halts when artefact missing.                                                           |

### AC2: Delivery endpoint supports expiring pre-signed URLs and optional webhook notification with metadata payload.

#### Scenarios

| ID           | Level       | Priority | Test                                                                                         | Justification                                                                                             |
| ------------ | ----------- | -------- | -------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------- |
| 3.3-UNIT-002 | Unit        | P0       | URL generator enforces minimal/maximum TTL and scopes before signature creation              | Protects against OPS-013 by validating parameters in isolation.                                          |
| 3.3-INT-003  | Integration | P0       | Delivery API issues pre-signed URL with correct TTL and revocation on retrieval              | Ensures secure access controls; critical for compliance.                                                  |
| 3.3-INT-004  | Integration | P1       | Webhook notification delivers metadata payload, retries on failure, and records audit trail  | Medium priority to ensure partner integration reliability.                                                |

### AC3: Integrity verification script allows recipients to confirm signatures and checksums locally.

#### Scenarios

| ID           | Level       | Priority | Test                                                                                  | Justification                                                                                           |
| ------------ | ----------- | -------- | ------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------- |
| 3.3-INT-005  | Integration | P0       | Run verification script against produced archive verifying signature and checksum outputs | Critical to maintain trust for integrators (SEC-010 mitigation).                                         |
| 3.3-E2E-001  | E2E         | P0       | Partner-style workflow downloads archive via URL, runs verification script, and records outcome | Confirms real-world ingest scenario works end-to-end.                                                    |

### AC4: Packaging step maintains â‰¤30 second SLA when invoked sequentially with two other runs.

#### Scenarios

| ID           | Level       | Priority | Test                                                                                              | Justification                                                                                                 |
| ------------ | ----------- | -------- | ------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------- |
| 3.3-INT-006  | Integration | P0       | Sequential packaging load test (three runs) measures runtime and ensures SLA compliance          | Directly mitigates PERF-009 by verifying throughput.                                                          |
| 3.3-INT-007  | Integration | P1       | Profiling run captures resource usage metrics and ensures alerts fire on SLA breach             | Medium priority to maintain observability and tuning loop.                                                    |

## Risk Coverage

- SEC-010 mitigated via URL TTL validation, delivery security checks, and verification script tests.
- DATA-012 addressed through manifest enforcement and negative packaging scenarios.
- OPS-013/PERF-009 covered by delivery TTL test and SLA load test.

## Recommended Execution Order

1. P0 unit tests (3.3-UNIT-001, 3.3-UNIT-002)
2. P0 integration tests (3.3-INT-001, 3.3-INT-002, 3.3-INT-003, 3.3-INT-005, 3.3-INT-006)
3. P0 E2E test (3.3-E2E-001)
4. P1 tests (3.3-INT-004, 3.3-INT-007)

## Quality Checklist

- [x] Every AC has test coverage
- [x] Test levels are appropriate (not over-testing)
- [x] No duplicate coverage across levels
- [x] Priorities align with business risk
- [x] Test IDs follow naming convention
- [x] Scenarios are atomic and independent
