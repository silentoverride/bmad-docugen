# Test Design: Story 3.6

Date: 2025-09-26
Designer: Quinn (Test Architect)

## Test Strategy Overview

- Total test scenarios: 10
- Unit tests: 3 (30.0%)
- Integration tests: 6 (60.0%)
- E2E tests: 1 (10.0%)
- Priority distribution: P0: 8, P1: 2, P2: 0

## Test Scenarios by Acceptance Criteria

### AC1: Infrastructure-as-code provisions core services across dev, staging, and production.

#### Scenarios

| ID           | Level       | Priority | Test                                                                                     | Justification                                                                                                  |
| ------------ | ----------- | -------- | ---------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------- |
| 3.6-UNIT-001 | Unit        | P0       | IaC policy test ensures required modules (orchestrator, queue, storage, observability) defined per environment | Prevents drift by catching missing resources early.                                                              |
| 3.6-INT-001  | Integration | P0       | Terraform/Terragrunt plan in sandbox verifies environment-specific configs align and pass policy checks          | Critical to guarantee reproducible provisioning.                                                                |
| 3.6-INT-002  | Integration | P1       | Drift detection simulation (manual change) triggers alert and blocks promotion                                   | Validates OPS-016 mitigation and governance.                                                                     |

### AC2: Promotion pipeline enforces change approvals, smoke tests, and rollback procedures.

#### Scenarios

| ID           | Level       | Priority | Test                                                                                              | Justification                                                                                                     |
| ------------ | ----------- | -------- | ------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------- |
| 3.6-UNIT-002 | Unit        | P0       | Pipeline policy unit test enforces presence of smoke test stage and approval gate                 | Ensures promotion pipeline cannot skip mandatory steps.                                                          |
| 3.6-INT-003  | Integration | P0       | CI pipeline run demonstrates approvals captured, smoke tests executed, and evidence stored        | Confirms gating behaviour before production use.                                                                 |
| 3.6-INT-004  | Integration | P0       | Forced smoke test failure triggers rollback path and halts promotion                              | Prevents faulty promotions and validates rollback automation (PERF-012 mitigation).                              |

### AC3: Environment configuration is version-controlled and peer reviewed.

#### Scenarios

| ID           | Level       | Priority | Test                                                                                        | Justification                                                                                             |
| ------------ | ----------- | -------- | ------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------- |
| 3.6-UNIT-003 | Unit        | P0       | Git hook/unit test ensures environment config changes signed and reference approved templates | Keeps DATA-015 under control by enforcing review process.                                                |
| 3.6-INT-005  | Integration | P0       | Promotion run captures config diff artefact stored in evidence repository                    | Provides audit trail required for compliance.                                                             |

### AC4: Runbooks document promotion steps, rollback triggers, and escalation paths.

#### Scenarios

| ID           | Level       | Priority | Test                                                                                       | Justification                                                                                        |
| ------------ | ----------- | -------- | ------------------------------------------------------------------------------------------ | ---------------------------------------------------------------------------------------------------- |
| 3.6-INT-006  | Integration | P0       | Tabletop drill follows runbook through promotion failure scenario capturing timestamps     | Ensures documentation actionable and mitigates BUS-011.                                              |
| 3.6-E2E-001  | E2E         | P1       | Multi-env rehearsal (devâ†’staging) executes full promotion pipeline with rollback dry run   | Confirms orchestration works across environments; medium risk once key controls proven.             |

## Risk Coverage

- OPS-016 mitigated via drift detection simulation and IaC policy enforcement.
- TECH-012 addressed by pipeline policy test and promotion run verifying smoke gates and rollback.
- DATA-015 covered by Git hook validation and config diff evidence capture.
- PERF-012 mitigated through rollback automation test and rehearsal scenario.
- BUS-011 handled by tabletop drill.

## Recommended Execution Order

1. P0 unit tests (3.6-UNIT-001, 3.6-UNIT-002, 3.6-UNIT-003)
2. P0 integration tests (3.6-INT-001, 3.6-INT-003, 3.6-INT-004, 3.6-INT-005, 3.6-INT-006)
3. P1 tests (3.6-INT-002, 3.6-E2E-001)

## Quality Checklist

- [x] Every AC has test coverage
- [x] Test levels are appropriate (not over-testing)
- [x] No duplicate coverage across levels
- [x] Priorities align with business risk
- [x] Test IDs follow naming convention
- [x] Scenarios are atomic and independent
