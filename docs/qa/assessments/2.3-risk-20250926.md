# Risk Profile: Story 2.3

Date: 2025-09-26
Reviewer: Quinn (Test Architect)

## Executive Summary

- Total Risks Identified: 5
- Critical Risks: 1
- High Risks: 3
- Risk Score: 42/100

Automated pixel fidelity and reconciliation guards are the last line of defense before compliant bundles reach auditors. A single blind spot in diff tooling or reconciliation propagation can mask layout drift or data inconsistencies. The most severe risk is unstable diff baselines that generate noisy failures or, worse, miss genuine regressions.

## Critical Risks Requiring Immediate Attention

### 1. TECH-009: Pixel Diff Tooling Misses Significant Layout Regressions
**Score:** 9 (Critical)

- **Probability:** High (3) – Headless rendering variance, font substitutions, and PDF rasterisation quirks can hide real differences or flood with noise if not tuned.
- **Impact:** High (3) – Layout defects slip into production, undermining confidence in NAB artefacts and compliance outcomes.
- **Mitigation:**
  - Calibrate diff thresholds per template with baseline acceptance metrics; include structural checks (DOM assertions) alongside pixel diffs.
  - Maintain golden fixtures under version control and regenerate via approved workflow only.
  - Run cross-environment comparison suite (CI vs local) to detect baseline divergence early.
- **Testing Focus:** Integration tests with intentionally altered templates ensuring diffs flag issues; multi-environment diff validation.

## High-Risk Items

### 2. DATA-009: Reconciliation Fails to Propagate Blocking Errors
**Score:** 6 (High)

- **Probability:** Medium (2) – As reconciliation spans multiple artefacts, missing hooks or async sequencing bugs can swallow errors.
- **Impact:** High (3) – Non-compliant bundles slip through, directly violating responsible lending commitments.
- **Mitigation:**
  - Enforce mandatory reconciliation status check prior to packaging; failing to receive positive confirmation should halt the run.
  - Instrument end-to-end tests with injected mismatches verifying run termination and diagnostics emission.
  - Log reconciliation checkpoints with trace IDs for postmortem analysis.
- **Testing Focus:** Integration tests injecting mismatched totals/dates; CLI gating tests verifying halt behaviour.

### 3. OPS-008: Diff Artefact Storage Lacks Retention & Traceability
**Score:** 6 (High)

- **Probability:** Medium (2) – Diff files can be large and often get purged without trace.
- **Impact:** High (3) – Auditors lose forensic evidence, and developers cannot debug regressions effectively.
- **Mitigation:**
  - Store diff artefacts in managed storage with retention aligned to audit needs; tag with manifest IDs.
  - Add lifecycle policies and alerting for unexpected deletions.
  - Provide CLI tooling to retrieve diff artefacts via manifest lookup.
- **Testing Focus:** Storage integration tests verifying retention policies; manifest linkage tests.

### 4. PERF-005: Visual Diff Execution Blows Up CI Timelines
**Score:** 6 (High)

- **Probability:** Medium (2) – Rendering and pixel comparison are resource-intensive; without optimisation they throttle pipelines.
- **Impact:** High (3) – Sluggish CI blocks releases and encourages teams to bypass fidelity checks.
- **Mitigation:**
  - Parallelise diff processing, leverage GPU-accelerated builds where available, or pre-render fixture snapshots.
  - Monitor CI execution time and enforce budgets; gate merges if fidelity checks are skipped.
  - Provide differential run mode (only rerun changed templates) to keep execution bounded.
- **Testing Focus:** Performance benchmarking; load tests measuring CI durations with fidelity checks enabled.

## Medium-Risk Items

### 5. BUS-005: Operator Feedback Loop for Fidelity Failures Incomplete
**Score:** 4 (Medium)

- **Probability:** Medium (2) – Without curated remediation guidance, operators may misinterpret diffs.
- **Impact:** Medium (2) – Slows resolution and could lead to overrides without fixing root causes.
- **Mitigation:**
  - Generate annotated diff reports with callouts and recommended actions.
  - Provide UI training materials and update runbooks to include fidelity troubleshooting steps.
  - Track time-to-resolution metrics to iterate on guidance quality.
- **Testing Focus:** UX validation of diff report consumption; telemetry tests on resolution metrics.

## Risk Distribution

### By Category
- Technical: 2 risks (1 critical, 1 high)
- Data: 1 risk (0 critical, 1 high)
- Operational: 1 risk (0 critical, 1 high)
- Performance: 1 risk (0 critical, 1 high)
- Business: 1 risk (0 critical, 0 high, 1 medium)
- Security: 0 risks

### By Component
- Diff tooling: 2 risks
- Reconciliation pipeline: 1 risk
- Storage/observability: 1 risk
- Operator UX: 1 risk

## Risk Matrix

| Risk ID  | Description                                         | Probability | Impact | Score | Priority |
|----------|-----------------------------------------------------|-------------|--------|-------|----------|
| TECH-009 | Pixel diff tooling misses significant regressions    | High (3)    | High (3) | 9   | Critical |
| DATA-009 | Reconciliation fails to propagate blocking errors    | Medium (2)  | High (3) | 6   | High     |
| OPS-008  | Diff artefact storage lacks retention & traceability | Medium (2)  | High (3) | 6   | High     |
| PERF-005 | Visual diff execution blows up CI timelines          | Medium (2)  | High (3) | 6   | High     |
| BUS-005  | Operator feedback loop for fidelity failures weak    | Medium (2)  | Medium (2) | 4 | Medium   |

## Detailed Risk Register

| Risk ID  | Category | Components Affected                   | Detection Method                                    | Mitigation Owner      | Residual Risk |
|----------|----------|---------------------------------------|-----------------------------------------------------|-----------------------|----------------|
| TECH-009 | Technical | Diff tooling, golden fixtures         | Golden fixture maintenance, diff regression suite   | Rendering Engineering | Medium – continuous tuning required |
| DATA-009 | Data     | Reconciliation service, CLI gating    | Failure injection tests, manifest audits            | Compliance Engineering | Low after gating enforced |
| OPS-008  | Operational | Storage buckets, manifest linkage  | Storage audits, retrieval smoke tests               | Platform Ops          | Medium – reliant on lifecycle monitoring |
| PERF-005 | Performance | CI pipeline, render workers        | Performance profiling, CI duration dashboards       | Platform Engineering  | Medium – requires ongoing optimisation |
| BUS-005  | Business | Operator documentation, UX training   | Feedback surveys, telemetry on resolution times     | Operations Enablement | Low with updated guidance |

## Risk-Based Testing Strategy

### Priority 1: Critical & High Risks
- Diff calibration tests across templates in CI (TECH-009).
- Reconciliation failure injections verifying run halts and diagnostics (DATA-009).
- Storage retention tests for diff artefacts and performance benchmarking of diff pipeline (OPS-008, PERF-005).

### Priority 2: Medium Risks
- UX validation of diff reports and runbooks (BUS-005).

### Priority 3: Baseline Regression
- Unit tests for diff threshold configuration and reconciliation utilities.
- Smoke tests verifying CLI summarises diff/reconciliation status with links.

## Risk Acceptance Criteria

### Must Fix Before Production
- TECH-009 must be controlled with calibrated diff tooling and golden fixture governance.
- DATA-009 gating must block packaging when reconciliation fails.

### Can Deploy with Mitigation
- OPS-008 and PERF-005 acceptable if retention monitoring and performance budgets are enforced.
- BUS-005 acceptable with documented remediation backlog.

### Accepted Risks
- None accepted currently.

## Monitoring Requirements
- Track diff pass/fail counts, runtime, and storage utilisation.
- Monitor reconciliation failure rates and operator override frequency.

## Risk Review Triggers
- Template updates or new artefact types.
- Changes to rendering infrastructure (Chromium, fonts).
- Operator feedback highlighting confusing diff outputs.

## Recommendations Summary
- Tune diff tooling rigorously and enforce golden fixture governance.
- Guarantee reconciliation failures stop packaging and provide actionable diagnostics.
- Preserve diff artefacts with traceable storage while optimising CI runtime.

Risk profile: docs/qa/assessments/2.3-risk-20250926.md
