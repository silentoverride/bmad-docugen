# Test Design: Story 5.2

Date: 2025-09-26
Designer: Quinn (Test Architect)

## Test Strategy Overview

- Total test scenarios: 9
- Unit tests: 3 (33.3%)
- Integration tests: 5 (55.6%)
- E2E tests: 1 (11.1%)
- Priority distribution: P0: 7, P1: 2, P2: 0

## Test Scenarios by Acceptance Criteria

### AC1: Evidence collector aggregates manifests, validation logs, and diff artefacts into signed bundles stored in MinIO with retention policies.

#### Scenarios

| ID           | Level       | Priority | Test                                                                                              | Justification                                                                                               |
| ------------ | ----------- | -------- | ------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------- |
| 5.2-UNIT-001 | Unit        | P0       | Bundle assembler verifies presence of manifests, validation logs, diff artefacts before signing  | Prevents DATA-021 by enforcing completeness at source.                                                     |
| 5.2-INT-001  | Integration | P0       | Collector integration test executes full aggregation, generates checksum, and validates signature | Ensures transactional bundle creation and integrity checks.                                                |
| 5.2-INT-002  | Integration | P0       | Failure injection (missing artefact) forces collector to retry or fail generation gracefully      | Confirms pipeline fails safe when evidence cannot be produced.                                            |

### AC2: Operators can request evidence snapshots via CLI or admin UI, receiving expiring links within two minutes.

#### Scenarios

| ID           | Level       | Priority | Test                                                                                                | Justification                                                                                                |
| ------------ | ----------- | -------- | --------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------ |
| 5.2-UNIT-002 | Unit        | P0       | Retrieval SLA guard ensures asynchronous job has two-minute timeout with alert on breach           | Enforces OPS-022 requirement.                                                                               |
| 5.2-INT-003  | Integration | P0       | CLI retrieval scenario measures response time and validates expiring signed URL + checksum delivery | Confirms CLI path meets SLA and security requirements.                                                      |
| 5.2-INT-004  | Integration | P1       | Admin UI retrieval flow verifies RBAC, link expiry, and telemetry logging                          | Medium risk once CLI path validated; ensures parity across surfaces.                                       |

### AC3: Every evidence bundle references originating rule set version, run manifest, and operator identity.

#### Scenarios

| ID           | Level       | Priority | Test                                                                                                   | Justification                                                                                                     |
| ------------ | ----------- | -------- | ------------------------------------------------------------------------------------------------------ | ----------------------------------------------------------------------------------------------------------------- |
| 5.2-UNIT-003 | Unit        | P0       | Metadata schema test checks rule version, manifest id, operator identity, and timestamps are required | Links bundles to governance data mitigating TECH-016.                                                             |
| 5.2-INT-005  | Integration | P0       | Retrieval API returns metadata and cross-checks against manifest/rule registry entries                 | Ensures traceability for auditors.                                                                                |

### AC4: Monitoring alerts when evidence collection fails or retention windows near expiry.

#### Scenarios

| ID           | Level       | Priority | Test                                                                                        | Justification                                                                                             |
| ------------ | ----------- | -------- | ------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------- |
| 5.2-INT-006  | Integration | P0       | Synthetic failure event triggers collector failure alert and creates incident ticket        | Keeps SEC-017/OPS-022 mitigation aligned with monitoring expectations.                                   |
| 5.2-E2E-001  | E2E         | P1       | Retention drill simulates approaching expiry, escalates to compliance, and confirms bundle renewal | Medium risk ensures retention governance works end-to-end.                                               |

## Risk Coverage

- DATA-021 mitigated through bundle completeness, failure injection, and checksum validation tests.
- SEC-017 addressed via retrieval tests ensuring signed URLs + RBAC and monitoring alerts.
- OPS-022 covered by SLA guard and latency measurements.
- TECH-016 handled by metadata schema and retrieval linkage tests.
- BUS-017 ensured through retention drill and alerting scenario.

## Recommended Execution Order

1. P0 unit tests (5.2-UNIT-001, 5.2-UNIT-002, 5.2-UNIT-003)
2. P0 integration tests (5.2-INT-001, 5.2-INT-002, 5.2-INT-003, 5.2-INT-005, 5.2-INT-006)
3. P1 tests (5.2-INT-004, 5.2-E2E-001)

## Quality Checklist

- [x] Every AC has test coverage
- [x] Test levels are appropriate (not over-testing)
- [x] No duplicate coverage across levels
- [x] Priorities align with business risk
- [x] Test IDs follow naming convention
- [x] Scenarios are atomic and independent
