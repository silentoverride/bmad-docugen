# Test Design: Story 4.1

Date: 2025-09-26
Designer: Quinn (Test Architect)

## Test Strategy Overview

- Total test scenarios: 10
- Unit tests: 3 (30.0%)
- Integration tests: 6 (60.0%)
- E2E tests: 1 (10.0%)
- Priority distribution: P0: 8, P1: 2, P2: 0

## Test Scenarios by Acceptance Criteria

### AC1: `docugen templates scaffold` generates versioned package with renderer stubs, manifest metadata, and test harness.

#### Scenarios

| ID           | Level       | Priority | Test                                                                                                        | Justification                                                                                                 |
| ------------ | ----------- | -------- | ----------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------- |
| 4.1-UNIT-001 | Unit        | P0       | Generator produces deterministic file set (stable timestamps, sorted exports)                                | Locks in determinism and mitigates TECH-013 regressions.                                                      |
| 4.1-INT-001  | Integration | P0       | Execute scaffold command and diff output against golden snapshot                                            | Validates generated structure stays aligned with expectations.                                               |
| 4.1-INT-002  | Integration | P0       | Scaffolded package executes lint/unit tests from generated harness                                          | Confirms scaffold output is runnable and production-ready.                                                    |
| 4.1-INT-006  | Integration | P0       | Security audit task (dependency vulnerability scan + script lint) runs on fresh scaffold                     | Mitigates SEC-012 by ensuring new packages inherit secure defaults.                                           |

### AC2: Scaffolded packages register with shared-type exports, ensuring CLI/API surfaces detect new artefacts without manual wiring.

#### Scenarios

| ID           | Level       | Priority | Test                                                                                               | Justification                                                                                             |
| ------------ | ----------- | -------- | -------------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------- |
| 4.1-UNIT-002 | Unit        | P0       | Schema binding test verifies generated types reference canonical shared schema definitions        | Prevents divergence from shared schema (DATA-016 mitigation).                                             |
| 4.1-INT-003  | Integration | P0       | Scaffolded package executed in CLI preview to confirm artefact registration and manifest updates | Ensures orchestration recognises new templates automatically.                                            |

### AC3: Integration tests exercise scaffold command end-to-end, including preview rendering and deterministic checksum verification.

#### Scenarios

| ID           | Level       | Priority | Test                                                                                          | Justification                                                                                             |
| ------------ | ----------- | -------- | --------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------- |
| 4.1-INT-004  | Integration | P0       | Run preview render on scaffolded template ensuring checksum matches golden output            | Confirms determinism promised to extension teams.                                                         |
| 4.1-E2E-001  | E2E         | P0       | End-to-end CLI workflow (scaffold → preview → checksum) validates developer experience        | Provides full-flow confidence ahead of partner use.                                                       |

### AC4: Developer documentation walks through extending NAB templates and highlights guardrails for future institutions.

#### Scenarios

| ID           | Level       | Priority | Test                                                                                         | Justification                                                                                               |
| ------------ | ----------- | -------- | -------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------- |
| 4.1-UNIT-003 | Unit        | P1       | Documentation lint ensures guardrails, anti-patterns, and references are present             | Keeps docs accurate for internal teams; medium risk.                                                        |
| 4.1-INT-005  | Integration | P1       | Pilot developer script follows docs to scaffold, render, and verify bundle; captures feedback | Validates enablement flow and mitigates BUS-012 through real-world rehearsal.                               |

## Risk Coverage

- DATA-016 addressed via schema binding unit test and preview determinism checks.
- TECH-013 mitigated by deterministic generator snapshot coverage.
- SEC-012 covered through the security audit integration scenario.
- OPS-017 handled by scaffold validation workflow and pilot rehearsal to monitor CI stability.

## Recommended Execution Order

1. P0 unit tests (4.1-UNIT-001, 4.1-UNIT-002)
2. P0 integration tests (4.1-INT-001, 4.1-INT-002, 4.1-INT-003, 4.1-INT-004, 4.1-INT-006)
3. P0 E2E test (4.1-E2E-001)
4. P1 tests (4.1-INT-005, 4.1-UNIT-003)

## Quality Checklist

- [x] Every AC has test coverage
- [x] Test levels are appropriate (not over-testing)
- [x] No duplicate coverage across levels
- [x] Priorities align with business risk
- [x] Test IDs follow naming convention
- [x] Scenarios are atomic and independent
