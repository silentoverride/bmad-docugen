# Test Design: Story 1.3

Date: 2025-09-26
Designer: Quinn (Test Architect)

## Test Strategy Overview

- Total test scenarios: 9
- Unit tests: 3 (33.3%)
- Integration tests: 5 (55.6%)
- E2E tests: 1 (11.1%)
- Priority distribution: P0: 7, P1: 2, P2: 0

## Test Scenarios by Acceptance Criteria

### AC1: Puppeteer renders NAB transaction listing, proof of balance, and payslip templates using shared data model placeholders.

#### Scenarios

| ID           | Level       | Priority | Test                                                                                                 | Justification                                                                                              |
| ------------ | ----------- | -------- | ---------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------- |
| 1.3-UNIT-001 | Unit        | P0       | Validate template placeholder map aligns with Story 1.1 schema fields                                | Guards against drift between schema and template bindings using fast feedback tests.                       |
| 1.3-INT-001  | Integration | P0       | Render each NAB template via Puppeteer using golden seed persona to produce PDFs                      | Exercises rendering pipeline end to end and verifies assets compile under headless Chromium.               |

### AC2: Rendered PDFs pass automated layout checks (e.g., CSS selectors present, page counts correct) in CI.

#### Scenarios

| ID           | Level       | Priority | Test                                                                                   | Justification                                                                                                      |
| ------------ | ----------- | -------- | -------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------ |
| 1.3-UNIT-002 | Unit        | P0       | Layout assertion definitions enforce required selectors, fonts, and page counts       | Keeps validation rules deterministic and reviewable without launching Chromium.                                    |
| 1.3-INT-002  | Integration | P0       | CI layout check suite runs against rendered PDFs, failing on missing selectors/pages  | Ensures automated gating catches regressions in real build environments.                                           |
| 1.3-INT-005  | Integration | P1       | Negative layout test injects malformed template to confirm assertions raise blocking errors | Validates failure-path diagnostics and prevents silent regressions slipping through CI.                              |

### AC3: Output bundle stores PDFs alongside manifest metadata in staging S3 bucket with deterministic filenames.

#### Scenarios

| ID           | Level       | Priority | Test                                                                                           | Justification                                                                                               |
| ------------ | ----------- | -------- | ---------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------- |
| 1.3-INT-003  | Integration | P0       | Upload pipeline writes PDFs to staging bucket with deterministic, manifest-linked filenames     | Critical for traceability and aligns with compliance storage expectations.                                  |
| 1.3-E2E-001  | E2E         | P0       | Full CLI-to-storage flow confirms manifest references map to retrievable PDFs in staging bucket | Verifies real-world user journey and ensures manifests remain in sync with stored artefacts.                |

### AC4: QA checksum comparison verifies repeated runs produce identical binary output when inputs are unchanged.

#### Scenarios

| ID           | Level       | Priority | Test                                                                                   | Justification                                                                                                |
| ------------ | ----------- | -------- | -------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------ |
| 1.3-UNIT-003 | Unit        | P1       | Checksum helper normalises metadata, excludes volatile fields, and produces stable digests | Lower-risk helper but essential to keep checksum calculations predictable and reviewable.                    |
| 1.3-INT-004  | Integration | P0       | Execute rendering twice and diff PDF checksums plus manifest entries for determinism        | High-risk guard against environmental drift highlighted in risk profile DATA-004.                             |

## Risk Coverage

Focuses on deterministic rendering (DATA-004), template-schema parity (DATA-003), and secure staging storage (SEC-002). P0 tests reinforce binary stability and layout gating so checksum regressions surface immediately.

## Recommended Execution Order

1. P0 unit tests (1.3-UNIT-001, 1.3-UNIT-002)
2. P0 integration tests (1.3-INT-001, 1.3-INT-002, 1.3-INT-003, 1.3-INT-004)
3. P0 E2E test (1.3-E2E-001)
4. P1 tests (1.3-UNIT-003, 1.3-INT-005)

## Quality Checklist

- [x] Every AC has test coverage
- [x] Test levels are appropriate (not over-testing)
- [x] No duplicate coverage across levels
- [x] Priorities align with business risk
- [x] Test IDs follow naming convention
- [x] Scenarios are atomic and independent
